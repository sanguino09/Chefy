<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chefy · Recetas inteligentes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <div class="background"></div>
  <header class="topbar">
    <div class="brand">
      <span class="brand__logo" aria-hidden="true">🍳</span>
      <span class="brand__name">Chefy</span>
    </div>
    <nav class="topbar__nav" aria-label="Acciones">
      <span id="userWelcome" class="user-badge" hidden></span>
      <button id="settingsButton" class="ghost icon-label" type="button" aria-haspopup="dialog" aria-controls="settingsPanel">
        <span class="icon" aria-hidden="true">⚙️</span>
        <span class="label">Configuración</span>
      </button>
      <div class="auth-group">
        <button id="authToggle" class="primary ghost icon-label" type="button" aria-haspopup="dialog" aria-controls="authDialog">
          <span class="icon" aria-hidden="true">🔑</span>
          <span class="label">Iniciar sesión</span>
        </button>
        <button
          id="adminButton"
          class="ghost icon-only"
          type="button"
          aria-haspopup="dialog"
          aria-controls="adminDialog"
          title="Panel de super admin"
          hidden
        >
          <span aria-hidden="true">🛠️</span>
          <span class="sr-only">Panel de super admin</span>
        </button>
        <button
          id="logoutButton"
          class="ghost icon-only"
          type="button"
          aria-label="Cerrar sesión"
          title="Cerrar sesión"
          hidden
        >
          <span aria-hidden="true">🚪</span>
        </button>
      </div>
    </nav>
  </header>

  <main class="layout" id="mainContent">
    <nav class="primary-tabs" role="tablist" aria-label="Vistas principales">
      <button
        type="button"
        class="primary-tabs__tab primary-tabs__tab--active"
        id="cookTab"
        role="tab"
        aria-selected="true"
        aria-controls="cookPanel"
        data-panel="cookPanel"
      >
        Cocinar
      </button>
      <button
        type="button"
        class="primary-tabs__tab"
        id="discoverTab"
        role="tab"
        aria-selected="false"
        aria-controls="discoverPanel"
        data-panel="discoverPanel"
      >
        Descubrir
      </button>
    </nav>

    <section id="cookPanel" class="primary-panel primary-panel--active" role="tabpanel" aria-labelledby="cookTab">
      <section class="hero" aria-labelledby="heroTitle">
        <div>
          <h1 id="heroTitle">Descubre recetas adaptadas a ti</h1>
          <p class="hero__subtitle">
            Genera desayunos, comidas o cenas inspiradas en tus gustos, al instante y sin ingredientes que no quieres ver ni en pintura.
          </p>
        </div>
        <div class="hero__cta">
          <button id="generateButton" class="cta-button" type="button">
            Generar receta
          </button>
          <p class="meal-hint" id="mealHint">Preparado para sorprenderte en cualquier momento del día.</p>
        </div>
      </section>


      <section class="dashboard" aria-label="Panel culinario">
        <div class="dashboard__main">
          <section class="card result" aria-live="polite" aria-atomic="true">
            <header class="result__header">
              <div class="result__heading">
                <h2 class="result__title" id="resultTitle">¿Qué vamos a cocinar?</h2>
                <p class="result__subtitle" id="resultSubtitle">Inicia sesión y pulsa el botón para que Chefy te recomiende una receta increíble.</p>
            </div>
            <div class="result__actions">
              <div class="share-control">
                <button
                  id="shareButton"
                  class="ghost icon-label"
                  type="button"
                  aria-haspopup="true"
                  aria-expanded="false"
                  aria-controls="shareMenu"
                  disabled
                >
                  <span class="icon" aria-hidden="true">📤</span>
                  <span class="label">Compartir receta</span>
                </button>
                <div id="shareMenu" class="share-menu" role="menu" data-share-type="recipe" hidden>
                  <button type="button" class="share-option" data-share-target="whatsapp" role="menuitem">
                    <span class="icon" aria-hidden="true">🟢</span>
                    <span class="label">WhatsApp</span>
                  </button>
                  <button type="button" class="share-option" data-share-target="telegram" role="menuitem">
                    <span class="icon" aria-hidden="true">✈️</span>
                    <span class="label">Telegram</span>
                  </button>
                  <button type="button" class="share-option" data-share-target="email" role="menuitem">
                    <span class="icon" aria-hidden="true">✉️</span>
                    <span class="label">Correo</span>
                  </button>
                  <button type="button" class="share-option" data-share-target="copy" role="menuitem">
                    <span class="icon" aria-hidden="true">📋</span>
                    <span class="label">Copiar</span>
                  </button>
                </div>
              </div>
              <div class="result__planner" aria-live="polite">
                <label for="planDaySelect">Añadir al plan semanal</label>
                <div class="result__planner-controls">
                  <select id="planDaySelect" name="planDaySelect">
                    <option value="lunes">Lunes</option>
                    <option value="martes">Martes</option>
                    <option value="miércoles">Miércoles</option>
                    <option value="jueves">Jueves</option>
                    <option value="viernes">Viernes</option>
                    <option value="sábado">Sábado</option>
                    <option value="domingo">Domingo</option>
                  </select>
                  <button id="addToPlanButton" class="ghost" type="button" disabled>Agregar</button>
                </div>
              </div>
            </div>
          </header>
          <div class="result__tags" id="resultTags" hidden></div>
          <p class="result__calories" id="resultCalories" hidden></p>
          <p class="result__cost" id="resultCost" hidden></p>
          <p class="result__description" id="resultDescription"></p>
          <div class="result__layout" id="resultDetails" hidden>
            <section class="result__section">
              <h3>Ingredientes</h3>
              <ul id="resultIngredients" class="result__list"></ul>
            </section>
            <section class="result__section result__section--steps">
              <div class="result__section-header">
                <h3>Pasos guiados</h3>
                <div id="stepModeToggle" class="steps-toggle" role="group" aria-label="Modo de preparación">
                  <button type="button" class="steps-toggle__button steps-toggle__button--active" data-mode="tradicional">Modo casero</button>
                  <button type="button" class="steps-toggle__button" data-mode="thermomix">Thermomix</button>
                </div>
              </div>
              <ol id="resultSteps" class="result__list"></ol>
            </section>
            <section class="result__section">
              <h3>Alternativas inteligentes</h3>
              <ul id="resultAlternatives" class="result__list"></ul>
            </section>
          </div>
          <aside id="chefTip" class="result__tip" hidden></aside>
        </section>

        <section class="card planner" aria-labelledby="plannerTitle">
          <header class="card__header planner__header">
            <div class="planner__title">
              <h2 id="plannerTitle">Planificador semanal</h2>
              <div class="planner__selector">
                <label class="sr-only" for="planSelect">Planificación activa</label>
                <select id="planSelect" name="planSelect" aria-label="Planificación activa"></select>
                <button id="addPlanButton" class="ghost icon-only" type="button" aria-label="Crear nueva planificación">
                  <span aria-hidden="true">＋</span>
                </button>
              </div>
            </div>
            <div class="planner__actions">
              <div class="share-control">
                <button
                  id="sharePlanButton"
                  class="ghost icon-label"
                  type="button"
                  aria-haspopup="true"
                  aria-expanded="false"
                  aria-controls="planShareMenu"
                  disabled
                >
                  <span class="icon" aria-hidden="true">🗓️</span>
                  <span class="label">Compartir plan</span>
                </button>
                <div id="planShareMenu" class="share-menu" role="menu" data-share-type="plan" hidden>
                  <button type="button" class="share-option" data-share-target="whatsapp" role="menuitem">
                    <span class="icon" aria-hidden="true">🟢</span>
                    <span class="label">WhatsApp</span>
                  </button>
                  <button type="button" class="share-option" data-share-target="telegram" role="menuitem">
                    <span class="icon" aria-hidden="true">✈️</span>
                    <span class="label">Telegram</span>
                  </button>
                  <button type="button" class="share-option" data-share-target="email" role="menuitem">
                    <span class="icon" aria-hidden="true">✉️</span>
                    <span class="label">Correo</span>
                  </button>
                  <button type="button" class="share-option" data-share-target="copy" role="menuitem">
                    <span class="icon" aria-hidden="true">📋</span>
                    <span class="label">Copiar</span>
                  </button>
                </div>
              </div>
              <button id="clearPlanButton" class="ghost icon-label" type="button">
                <span class="icon" aria-hidden="true">🧹</span>
                <span class="label">Limpiar plan</span>
              </button>
            </div>
          </header>
          <p class="card__hint">Organiza desayunos, comidas y cenas en un vistazo y mantén tus ideas siempre a mano.</p>
          <div class="planner__grid" id="weeklyPlanGrid" role="grid"></div>
          <section class="shopping" aria-labelledby="shoppingTitle">
            <div class="shopping__header">
              <h3 id="shoppingTitle">Lista inteligente de la compra</h3>
              <button id="copyShoppingButton" class="ghost" type="button">Copiar</button>
            </div>
            <p class="card__hint">Se actualiza automáticamente con tus recetas planificadas.</p>
            <ul id="shoppingList" class="shopping__list"></ul>
          </section>
        </section>
      </div>

      <aside class="dashboard__aside">
        <section class="card categories" aria-labelledby="cuisineTitle">
          <header class="card__header">
            <h2 id="cuisineTitle">Categorías favoritas</h2>
            <p class="card__hint">Pulsa para priorizar un estilo culinario en tus próximas sugerencias.</p>
          </header>
          <div class="chips" id="cuisineQuickFilters"></div>
        </section>

        <section class="card history" aria-labelledby="historyTitle">
          <header class="card__header">
            <h2 id="historyTitle">Historial de recetas</h2>
            <button id="clearHistoryButton" class="ghost" type="button">Vaciar</button>
          </header>
          <p class="card__hint">Repite tus favoritas o vuelve a esas ideas que guardaste al vuelo.</p>
          <ul id="historyList" class="history__list"></ul>
        </section>
      </aside>

      </section>
    </section>

    <section id="discoverPanel" class="primary-panel" role="tabpanel" aria-labelledby="discoverTab" hidden>
      <section class="card discover" aria-labelledby="discoverTitle">
        <header class="card__header">
          <div>
            <h2 id="discoverTitle">Ideas de la comunidad</h2>
            <p class="card__hint">Explora planificaciones y recetas compartidas por otros chefs caseros y súmalas a tu colección.</p>
          </div>
        </header>
        <div id="discoverFeed" class="discover__list" aria-live="polite"></div>
      </section>

      <section class="card discover-form" aria-labelledby="discoverFormTitle">
        <header class="card__header">
          <div>
            <h2 id="discoverFormTitle">Comparte tus ideas</h2>
            <p class="card__hint">Publica tu última receta o plan semanal para inspirar a otros. Se guarda en este dispositivo.</p>
          </div>
        </header>
        <form id="discoverForm" class="discover-form__body">
          <div class="discover-form__grid">
            <div class="discover-form__group">
              <label for="discoverType">Tipo de publicación</label>
              <select id="discoverType" name="discoverType">
                <option value="recipe">Receta destacada</option>
                <option value="plan">Planificación semanal</option>
              </select>
            </div>
            <div class="discover-form__group">
              <label for="discoverAuthor">Autor</label>
              <input id="discoverAuthor" name="discoverAuthor" type="text" placeholder="Tu nombre o correo" autocomplete="off">
            </div>
          </div>
          <div class="discover-form__group">
            <label for="discoverTitleInput">Título</label>
            <input id="discoverTitleInput" name="discoverTitleInput" type="text" required placeholder="Ej. Batch cooking sin gluten">
          </div>
          <div class="discover-form__group">
            <label for="discoverSummary">Resumen breve</label>
            <textarea id="discoverSummary" name="discoverSummary" rows="2" placeholder="Cuenta qué hace especial a tu propuesta"></textarea>
          </div>
          <div class="discover-form__group">
            <label for="discoverDetails">Detalle o notas</label>
            <textarea id="discoverDetails" name="discoverDetails" rows="5" placeholder="Incluye ingredientes clave, pasos o estructura del plan"></textarea>
          </div>
          <div class="discover-form__actions">
            <button type="button" id="discoverPrefillRecipe" class="ghost">Usar mi última receta</button>
            <button type="button" id="discoverPrefillPlan" class="ghost">Usar plan activo</button>
            <button type="submit" class="primary">Compartir con la comunidad</button>
          </div>
          <p id="discoverFeedback" class="form-feedback" role="status"></p>
        </form>
      </section>
    </section>
  </main>

  <footer class="footer">
    <p class="footer__brand">© <span id="currentYear"></span> Chefy. Cocina inteligente, cada día.</p>
    <div class="footer__links" aria-label="Información legal">
      <button type="button" class="link" data-modal="privacyDialog">Política de privacidad</button>
      <button type="button" class="link" data-modal="termsDialog">Términos y condiciones</button>
    </div>
  </footer>

  <dialog id="settingsPanel" class="modal" aria-labelledby="settingsTitle">
    <form method="dialog" class="modal__content" id="settingsForm">
      <header class="modal__header">
        <h2 id="settingsTitle">Preferencias de ingredientes</h2>
        <button type="submit" class="icon-button" aria-label="Cerrar configuración">
          ✕
        </button>
      </header>
      <p class="modal__intro">Selecciona los ingredientes que quieres excluir de tus recetas. Puedes añadir los tuyos propios.</p>
      <p id="settingsStatus" class="settings__status" role="status"></p>
      <section class="chips" id="defaultRestrictions">
        <!-- Chips autogenerados desde JavaScript -->
      </section>
      <div class="custom-restriction">
        <label for="customRestriction">Añadir ingrediente a evitar</label>
        <div class="custom-restriction__row">
          <input type="text" id="customRestriction" name="customRestriction" placeholder="Ej. judías verdes" autocomplete="off">
          <button type="button" id="addRestriction" class="ghost">Añadir</button>
        </div>
      </div>
      <section class="active-restrictions">
        <h3>Ingredientes bloqueados</h3>
        <ul id="activeRestrictions" class="active-restrictions__list" aria-live="polite"></ul>
      </section>


      <section class="settings__group">
        <h3>Estilos culinarios preferidos</h3>
        <p class="settings__hint">Selecciona los tipos de cocina que quieres priorizar. Si no eliges ninguno, tendrás recomendaciones de todo el mundo.</p>
        <div class="chips" id="cuisineChips"></div>
      </section>

    </form>
  </dialog>

  <dialog id="authDialog" class="modal" aria-labelledby="authTitle">
    <form method="dialog" class="modal__content" id="authForm">
      <header class="modal__header">
        <h2 id="authTitle">Bienvenido a Chefy</h2>
        <button type="submit" class="icon-button" aria-label="Cerrar acceso">
          ✕
        </button>
      </header>
      <div class="tabs" role="tablist" aria-label="Método de acceso">
        <button class="tab tab--active" role="tab" id="loginTab" aria-controls="loginPanel" aria-selected="true">Iniciar sesión</button>
        <button class="tab" role="tab" id="registerTab" aria-controls="registerPanel" aria-selected="false">Crear cuenta</button>
      </div>
      <div class="tab-panel tab-panel--active" id="loginPanel" role="tabpanel" aria-labelledby="loginTab">
        <label for="loginEmail">Correo electrónico</label>
        <input type="email" id="loginEmail" autocomplete="username" required>
        <label for="loginPassword">Contraseña</label>
        <input type="password" id="loginPassword" autocomplete="current-password" required>
        <p class="form-hint">Utilizamos almacenamiento local seguro para recordar tus preferencias.</p>
        <button type="button" id="loginButton" class="primary">Entrar</button>
      </div>
      <div class="tab-panel" id="registerPanel" role="tabpanel" aria-labelledby="registerTab">
        <label for="registerEmail">Correo electrónico</label>
        <input type="email" id="registerEmail" autocomplete="username" required>
        <label for="registerPassword">Contraseña</label>
        <input type="password" id="registerPassword" autocomplete="new-password" minlength="6" required>
        <p class="form-hint">Tu cuenta guardará tus configuraciones y restricciones de ingredientes.</p>
        <button type="button" id="registerButton" class="primary">Registrarme</button>
      </div>
      <p class="form-feedback" id="authFeedback" role="alert"></p>
    </form>
  </dialog>

  <dialog id="adminDialog" class="modal admin" aria-labelledby="adminTitle">
    <form method="dialog" class="modal__content admin__content" id="adminShell">
      <header class="modal__header">
        <h2 id="adminTitle">Panel de super admin</h2>
        <button type="submit" class="icon-button" aria-label="Cerrar panel de super admin">✕</button>
      </header>
      <div class="admin__layout">
        <section class="admin__panel">
          <div class="admin__panel-header">
            <h3>Recetario activo</h3>
            <p class="admin__hint">Selecciona una receta para editarla o crea una nueva.</p>
          </div>
          <div class="admin__catalog">
            <ul id="adminRecipeList" class="admin-recipe-list" aria-live="polite"></ul>
            <div class="admin__actions">
              <button type="button" id="adminNewRecipeButton" class="ghost">Nueva receta</button>
              <button type="button" id="adminDeleteRecipeButton" class="ghost danger" disabled>Eliminar</button>
            </div>
          </div>
        </section>
        <section class="admin__panel">
          <div class="admin__panel-header">
            <h3>Editor de receta</h3>
            <p class="admin__hint">Completa los campos para guardar cambios o añadir una receta.</p>
          </div>
          <div class="admin-form" id="adminRecipeForm">
            <div class="admin-form__group">
              <label for="adminRecipeId">Identificador</label>
              <input id="adminRecipeId" type="text" readonly>
              <p class="form-hint">Se genera automáticamente a partir del nombre.</p>
            </div>
            <div class="admin-form__grid">
              <div class="admin-form__group">
                <label for="adminRecipeName">Nombre</label>
                <input id="adminRecipeName" type="text" required>
              </div>
              <div class="admin-form__group">
                <label for="adminRecipeMeal">Comida</label>
                <select id="adminRecipeMeal">
                  <option value="desayuno">Desayuno</option>
                  <option value="comida">Comida</option>
                  <option value="cena">Cena</option>
                </select>
              </div>
              <div class="admin-form__group">
                <label for="adminRecipeCalories">Calorías</label>
                <input id="adminRecipeCalories" type="number" min="0" step="1" placeholder="480">
              </div>
            </div>
            <div class="admin-form__grid">
              <div class="admin-form__group">
                <label for="adminRecipeTime">Tiempo</label>
                <input id="adminRecipeTime" type="text" placeholder="20 minutos">
              </div>
              <div class="admin-form__group">
                <label for="adminRecipeServings">Raciones</label>
                <input id="adminRecipeServings" type="text" placeholder="2 raciones">
              </div>
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeCuisines">Cocinas (separadas por comas)</label>
              <input id="adminRecipeCuisines" type="text" placeholder="mediterranea, fusion">
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeTags">Etiquetas (separadas por comas)</label>
              <input id="adminRecipeTags" type="text" placeholder="alto en proteínas, sin gluten">
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeKeywords">Palabras clave (separadas por comas)</label>
              <input id="adminRecipeKeywords" type="text" placeholder="pasta, tomate, albahaca">
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeDescription">Descripción corta</label>
              <textarea id="adminRecipeDescription" rows="3" placeholder="Describe brevemente la receta."></textarea>
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeIngredients">Ingredientes (uno por línea, formato "cantidad | ingrediente")</label>
              <textarea id="adminRecipeIngredients" rows="6" placeholder="1 taza | arroz integral"></textarea>
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeIngredientPrices">Precios de ingredientes ("ingrediente | precio en euros | formato o cantidad")</label>
              <textarea
                id="adminRecipeIngredientPrices"
                rows="4"
                placeholder="yogur griego natural | 1.35 | tarrina 200 g"
              ></textarea>
              <p class="form-hint">Usa punto decimal para los importes. El formato se mostrará junto al precio estimado.</p>
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeIngredientStores">Supermercados ("ingrediente | Mercadona:producto,precio | Carrefour:producto,precio ...")</label>
              <textarea
                id="adminRecipeIngredientStores"
                rows="4"
                placeholder="yogur griego natural | Mercadona:Yogur griego Hacendado 2x125 g,1.15 | Carrefour:Yogur Griego Carrefour 0%,1.25"
              ></textarea>
              <p class="form-hint">Incluye Mercadona, Carrefour, Alcampo o Lidl. El precio es opcional por comercio.</p>
            </div>
            <div class="admin-form__grid admin-form__grid--steps">
              <div class="admin-form__group">
                <label for="adminRecipeStepsCasero">Pasos modo casero (uno por línea)</label>
                <textarea id="adminRecipeStepsCasero" rows="6" placeholder="Describe cada paso para cocina tradicional."></textarea>
              </div>
              <div class="admin-form__group">
                <label for="adminRecipeStepsThermomix">Pasos para Thermomix (uno por línea)</label>
                <textarea id="adminRecipeStepsThermomix" rows="6" placeholder="Incluye temperatura, velocidades y tiempos."></textarea>
              </div>
            </div>
            <div class="admin-form__group">
              <label for="adminRecipeSwaps">Alternativas (formato "ingrediente: opción 1, opción 2")</label>
              <textarea id="adminRecipeSwaps" rows="4" placeholder="queso: tofu, levadura nutricional"></textarea>
            </div>
            <div class="admin-form__actions">
              <button type="button" id="adminSaveRecipeButton" class="primary">Guardar cambios</button>
            </div>
          </div>
        </section>
        <aside class="admin__panel admin__panel--users">
          <div class="admin__panel-header">
            <h3>Usuarios registrados</h3>
            <p class="admin__hint">Consulta los accesos creados en este navegador.</p>
          </div>
          <ul id="adminUserList" class="admin-user-list" aria-live="polite"></ul>
        </aside>
      </div>
      <p class="form-feedback" id="adminFeedback" role="status"></p>
    </form>
  </dialog>

  <dialog id="privacyDialog" class="modal legal" aria-labelledby="privacyTitle">
    <form method="dialog" class="modal__content">
      <header class="modal__header">
        <h2 id="privacyTitle">Política de privacidad</h2>
        <button type="submit" class="icon-button" aria-label="Cerrar política de privacidad">✕</button>
      </header>
      <div class="modal__body">
        <p>Chefy almacena tus datos de acceso y preferencias en tu propio navegador utilizando almacenamiento local. No compartimos tus datos con terceros.</p>
        <p>Puedes eliminar la información en cualquier momento desde la sección de configuración o borrando los datos del sitio en tu navegador.</p>
      </div>
    </form>
  </dialog>

  <dialog id="termsDialog" class="modal legal" aria-labelledby="termsTitle">
    <form method="dialog" class="modal__content">
      <header class="modal__header">
        <h2 id="termsTitle">Términos y condiciones</h2>
        <button type="submit" class="icon-button" aria-label="Cerrar términos y condiciones">✕</button>
      </header>
      <div class="modal__body">
        <p>El servicio de Chefy se ofrece tal cual. Las recetas son sugerencias generadas automáticamente. Verifica los ingredientes si tienes alergias o restricciones médicas.</p>
        <p>Al utilizar Chefy aceptas que eres responsable de revisar y validar cada receta antes de cocinarla.</p>
      </div>
    </form>
  </dialog>

  <script src="assets/js/app.js" type="module"></script>
</body>
</html>
